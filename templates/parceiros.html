<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Cadastro de Parceiros</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  {% include '_nav.html' %}
  <main class="page-content">
    <div class="container">
      <header class="section-header">
        <h1>Cadastro de Parceiros</h1>
        <p>Sistema para cadastro e gerenciamento de parceiros comerciais</p>
      </header>

      <div class="form-container">
        <form id="partnerForm">
          <div class="form-section">
            <h2 class="section-title">Informações do Parceiro</h2>
            <div class="form-row">
              <div class="form-group">
                <label for="cidade">Cidade</label>
                <input type="text" id="cidade" name="cidade" required>
              </div>
              <div class="form-group">
                <label for="estado">Estado</label>
                <select id="estado" name="estado" required>
                  <option value="">Selecione</option>
                  <option value="AC">Acre</option>
                  <option value="AL">Alagoas</option>
                  <option value="AP">Amapá</option>
                  <option value="AM">Amazonas</option>
                  <option value="BA">Bahia</option>
                  <option value="CE">Ceará</option>
                  <option value="DF">Distrito Federal</option>
                  <option value="ES">Espírito Santo</option>
                  <option value="GO">Goiás</option>
                  <option value="MA">Maranhão</option>
                  <option value="MT">Mato Grosso</option>
                  <option value="MS">Mato Grosso do Sul</option>
                  <option value="MG">Minas Gerais</option>
                  <option value="PA">Pará</option>
                  <option value="PB">Paraíba</option>
                  <option value="PR">Paraná</option>
                  <option value="PE">Pernambuco</option>
                  <option value="PI">Piauí</option>
                  <option value="RJ">Rio de Janeiro</option>
                  <option value="RN">Rio Grande do Norte</option>
                  <option value="RS">Rio Grande do Sul</option>
                  <option value="RO">Rondônia</option>
                  <option value="RR">Roraima</option>
                  <option value="SC">Santa Catarina</option>
                  <option value="SP">São Paulo</option>
                  <option value="SE">Sergipe</option>
                  <option value="TO">Tocantins</option>
                </select>
              </div>
              <div class="form-group">
                <label for="parceiro">Parceiro</label>
                <input type="text" id="parceiro" name="parceiro" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="distribuidora">Distribuidora</label>
                <input type="text" id="distribuidora" name="distribuidora">
              </div>
              <div class="form-group">
                <label for="cnpj_cpf">CNPJ/CPF</label>
                <input type="text" id="cnpj_cpf" name="cnpj_cpf" required>
              </div>
              <div class="form-group">
                <label for="telefone">Telefone</label>
                <input type="tel" id="telefone" name="telefone" required>
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email">
              </div>
            </div>
          </div>

          <div class="form-section">
            <h2 class="section-title">Informações Financeiras</h2>
            <div class="form-row">
              <div class="form-group">
                <label for="dia_pagamento">Dia do Pagamento</label>
                <input type="number" id="dia_pagamento" name="dia_pagamento" min="1" max="31">
              </div>
              <div class="form-group">
                <label for="banco">Banco</label>
                <input type="text" id="banco" name="banco">
              </div>
              <div class="form-group">
                <label for="agencia_conta">Agência e Conta</label>
                <input type="text" id="agencia_conta" name="agencia_conta">
              </div>
              <div class="form-group">
                <label for="pix">Chave PIX</label>
                <input type="text" id="pix" name="pix">
              </div>
            </div>
          </div>

          <div class="form-section prices-section">
            <h2 class="section-title">Valores dos Produtos</h2>
            <div class="form-row">
              <div class="form-group">
                <label for="cx_copo">Valor CX Copo</label>
                <input type="number" id="cx_copo" name="cx_copo" min="0" step="0.01" value="0">
              </div>
              <div class="form-group">
                <label for="dez_litros">Valor 10 Litros</label>
                <input type="number" id="dez_litros" name="dez_litros" min="0" step="0.01" value="0">
              </div>
              <div class="form-group">
                <label for="vinte_litros">Valor 20 Litros</label>
                <input type="number" id="vinte_litros" name="vinte_litros" min="0" step="0.01" value="0">
              </div>
              <div class="form-group">
                <label for="mil_quinhentos_ml">Valor 1500 ml</label>
                <input type="number" id="mil_quinhentos_ml" name="mil_quinhentos_ml" min="0" step="0.01" value="0">
              </div>
              <div class="form-group">
                <label for="vasilhame">Valor Vasilhame</label>
                <input type="number" id="vasilhame" name="vasilhame" min="0" step="0.01" value="0">
              </div>
            </div>
            <div class="total-display">
              Total estimado: <span id="total-prices">0</span>
            </div>
          </div>

          <div class="btn-container">
            <button type="submit" class="btn btn-success">Cadastrar Parceiro</button>
            <button type="reset" class="btn btn-danger">Limpar formulário</button>
          </div>
        </form>
      </div>

      <div class="partners-list">
        <div class="list-header">Parceiros cadastrados</div>
        <div class="table-wrapper">
          <table id="partnersTable">
            <thead>
              <tr>
                <th>Cidade</th>
                <th>Estado</th>
                <th>Parceiro</th>
                <th>Distribuidora</th>
                <th>CNPJ/CPF</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="partnersTableBody"></tbody>
          </table>
        </div>
        <p id="emptyMessage" class="empty-message">Nenhum parceiro cadastrado ainda.</p>
      </div>
    </div>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('partnerForm');
    const partnersTableBody = document.getElementById('partnersTableBody');
    const emptyMessage = document.getElementById('emptyMessage');
    const totalDisplay = document.getElementById('total-prices');

    let partners = JSON.parse(localStorage.getItem('partners')) || [];

    updatePartnersTable();
    calculateTotal();

    const priceInputs = document.querySelectorAll('.prices-section input[type="number"]');
    priceInputs.forEach(input => {
      input.addEventListener('input', calculateTotal);
    });

    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
    }

    function calculateTotal() {
      const values = Array.from(priceInputs).map(input => parseFloat(input.value) || 0);
      const total = values.reduce((acc, curr) => acc + curr, 0);
      totalDisplay.textContent = formatCurrency(total);
    }

    function updatePartnersTable() {
      partnersTableBody.innerHTML = '';

      if (partners.length === 0) {
        emptyMessage.style.display = 'block';
        return;
      }

      emptyMessage.style.display = 'none';

      partners.forEach(partner => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${partner.cidade}</td>
          <td>${partner.estado}</td>
          <td>${partner.parceiro}</td>
          <td>${partner.distribuidora || '-'}</td>
          <td>${partner.cnpj_cpf}</td>
          <td>${partner.telefone}</td>
          <td>${partner.email || '-'}</td>
          <td>${formatCurrency(partner.total)}</td>
        `;
        partnersTableBody.appendChild(row);
      });
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const formData = new FormData(form);
      const partnerData = {};

      for (let [key, value] of formData.entries()) {
        partnerData[key] = value;
      }

      const total = Array.from(priceInputs).reduce((acc, input) => acc + (parseFloat(input.value) || 0), 0);
      partnerData.total = total;

      partners.push(partnerData);
      localStorage.setItem('partners', JSON.stringify(partners));

      updatePartnersTable();
      form.reset();
      calculateTotal();
      alert('Parceiro cadastrado com sucesso!');
    });
  });
  </script>
  </main>
</body>
</html>
